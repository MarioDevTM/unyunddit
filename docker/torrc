# Tor configuration for hidden service + SOCKS proxy
# Optimized for Railway and Digital Ocean deployment

SocksPort 9050 # Enable SOCKS proxy for potential future features
HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:8080

# Security settings
DataDirectory /var/lib/tor
RunAsDaemon 0
User tor

# CRITICAL: Ensure we are NOT an exit node
ExitPolicy reject *:*
ExitRelay 0

# Disable relay functionality completely
ORPort 0
DirPort 0
BridgeRelay 0

# Logging - reduced verbosity for Railway visibility
Log notice file /var/log/tor/notices.log
Log notice stdout
Log warn stdout
Log err stdout

# Allow connections from localhost
SocksPolicy accept 127.0.0.1
SocksPolicy reject *

# Additional security
ClientOnly 1

# Performance optimizations for cloud deployment
CircuitBuildTimeout 30
LearnCircuitBuildTimeout 0
MaxCircuitDirtiness 600

# Maximum output size Tor will decompress before killing stream
MaxUncompressedCellBytes 1048576    # (default ~10MB, set lower, e.g., 1MB)

# Maximum compression ratio Tor tolerates before aborting
MaxCompressionRatio 10  # default is 20, try lowering
